## 变量的作用域

程序中每个变量都要经历分配存储空间，用以存放该变量的值，然后在程序中使用变量，使用结束后释放所占有的存储空间的过程被称为**变量的生命周期**。在变量生命周期内该变量可以使用的范围称为变量的**作用域**。

变量的作用域是一个**空间概念**，由定义变量**语句位置**决定，根据变量定义语句位置的不同，变量被分为局部变量和全局变量。变量的生存期是一个**时间概念**，由变量的**存储类型**决定。

## 变量的存储类型

c中每个变量都具有两个属性：**数据类型**、**存储类型**。数据类型决定了变量在内存中分配存储单元的大小。而存储类型是指数据在内存中的存储方式，其被分为**静态存储**方式和**动态存储**方式。

静态存储方式指在程序运行期间分配固定存储空间，整个运行期间保持不变，直到运行结束才释放所占有的存储空间。

动态存储方式指在程序运行过程中，根据需要，使用时才分配存储空间，使用结束后立即释放。典型就是函数形参，只在函数调用时被分配。

c中变量有四种存储类型。`auto`自动型，`extern`外部型，`static`静态型，`register`寄存器型。
c程序在运行时使用的存储空间分为

* 程序区，用于存放代码。
* 静态存储区，用于存放程序全局变量和静态数据
* 动态存储区，存储函数调用时现场保护和返回地址，函数形参和自动变量。

## 内部变量

在函数内定义的变量成为内部变量，它的作用域仅限于其所在函数，所以也称为局部变量。局部变量可分为自动变量和静态局部变量。

```c
//auto关键字可缺省，函数内定义的缺省auto都是自动变量，也是局部变量。
auto int i;
```

## 外部变量

在函数外部定义的变量称为外部变量，也就是全局变量。全局变量可以被本源程序文件中其他函数使用。它生存期为整个程序。所以它提供了函数除实参-形参传送方式外的另一种数据传递方式。要使外部变量成为真正的全局变量，必须在所有函数之前定义外部变量。也就是说我们如果在程序中间定义，定义之前的函数想引用，要使用关键字`extern`进行**引用性声明**。总之，应该尽可能不用或少用全局变量，以增强函数独立性。

```c
void f1() {
	extern m;
}

int m = 100;

//内部与外部同名，内部屏蔽外部
int n = 100;
void f2() {
	int n = 29;
	printf("%d", n)
}
```

## 静态变量

静态变量，系统分配固定的存储单元，并在程序运行过程中始终存在，直到源程序运行结束，所以静态变量的生存周期为整个源程序。根据作用域分为静态局部变量和静态全局变量。

**静态局部**

函数内定义静态变量为静态局部变量。它的作用域同auto，不同在于函数调用后，auto变量存储空间被释放，而静态变量仅在编译时初始化一次，**它能够保存变量上次调用后的值**。

```c
int fact(int n) {
	static int f = 1;
	f = f * n;
	return f;
}
```

**静态全局**

静态全局和全局变量的存储方式都为静态存储方式，区别在于作用域的扩展不同。**静态全局只能被该源文件中的函数使用**，而全局变量可以通过关键字`extern`将作用于扩展到其他源程序文件。

```c
static int max, min;
```

## 寄存器变量

寄存器变量指将局部变量(auto)的值存放在cpu寄存器中，它的存取速度远高于内存，所以可以将使用频繁的局部变量定义为寄存器变量。

* 只有局部变量和形式参数可以定义为寄存器变量。
* 函数调用时分配寄存器，调用结束就释放所分配寄存器。

```c
long sum(int n) {
	register long i;
}
```

## 变量

总的来说，变量按存储类型分为，局部(auto)、全局(extern引用)、静态(static)、寄存器(局部register)4种类型。

## 动态内存分配

```c
//分配
void *malloc(unsigned int size);
//释放
void free(void *p);
```

* 最好在同一个函数内动态分配和释放存储空间。
* 最好在定义指针时将指针初始化为NULL，在释放指针后将指针赋值为NULL，便于在判断指针有效性时用P == NULL判断指针是否为空指针。
* 使用该函数需引入"stdlib.h"头文件。
